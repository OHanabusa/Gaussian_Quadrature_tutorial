# ガウス求積入門 — 実装のための基礎から一般区間への拡張

---

## 導入 — なぜ数値積分を学ぶのか？

- **解析解が得られない積分が多い**\
  複雑な関数、実測データ、確率分布の畳み込みなどは閉形式の積分解を持ちません。
- **実装必須のアルゴリズムが増えている**\
  有限要素法 (FEM)、確率シミュレーション、機械学習の期待値計算、物理ベースレンダリングなど、プログラム内で“積分器”を自作する場面が多々あります。
- **ガウス求積は少点数で高精度**\
  同じ精度を得るのに台形則や Simpson 則より格段に少ない評価回数で済み、計算コストを抑えられます。

> **目的**：ガウス求積公式と係数表を提示し、任意区間に拡張する手順、および実装演習までを体系的にまとめます。

---

## 1.1 基本式

$$
\int_{-1}^{1} f(x) dx  \approx  \sum_{i=1}^{n} w_i f(x_i) \qquad (1)
$$

**式 (1) の意味**：左辺は区間 \([-1,1]\) の正確な積分値、右辺は **有限個 ****\(n\)**** 個の点での関数評価** と **重み付き和** によって近似したものです。ガウス点 \(x_i\) と重み \(w_i\) は「Legendre 多項式の零点」と「その零点に対して誤差が最小となる係数」として選ばれており、\(2n-1\) 次までの多項式については誤差が理論的にゼロになります。

| \(n\) | ガウス点 \(x_i\)                              | 重み \(w_i\)                                              |
| ----- | ----------------------------------------- | ------------------------------------------------------- |
| 2     | \(\pm0.5773502692\)                       | 1.0000000000                                            |
| 3     | \(\pm0.7745966692, 0\)                   | 0.5555555556 (両端), 0.8888888889 (中央)                    |
| 4     | \(\pm0.8611363116, \pm0.3399810436\)     | 0.3478548451 (外側), 0.6521451549 (内側)                    |
| 5     | \(\pm0.9061798459, \pm0.5384693101, 0\) | 0.2369268851 (最外), 0.4786286705 (中間), 0.5688888889 (中央) |

---

## 2.0 何をしたいのか？

ガウス求積は標準区間 \([-1,1]\) に対して定義されています。しかし、実務では **任意の有限区間 ****\([x_1,x_2]\)** の積分を評価することが一般的です。この章では「区間変換」と「ヤコビアン補正」により、式 (1) をそのまま他区間へ適用できる形に一般化します。

## 2.1 変数変換

$$
\xi \in [-1,1], \qquad x(\xi)=\frac{x_2-x_1}{2} \xi + \frac{x_1+x_2}{2}. \qquad(2)
$$

**式 (2) の意味**：パラメータ \(\xi\) を用いて線形写像を定義し、標準区間 \([-1,1]\) の任意点 \(\xi\) を区間 \([x_1,x_2]\) の点 \(x\) へマッピングします。

## 2.2 ヤコビアン

$$
\frac{dx}{d\xi}=\frac{x_2-x_1}{2}=J. \qquad(3)
$$

**式 (3) の意味**：変数変換で生じる区間の伸縮を補正するスケール係数（ヤコビアン）です。

## 2.3 一般区間でのガウス求積公式

$$
\boxed{\displaystyle
\int_{x_1}^{x_2} f(x) dx  \approx  J \sum_{i=1}^{n} w_i f\!\left( \frac{x_2-x_1}{2} \xi_i+\frac{x_1+x_2}{2} \right)
}\qquad (4)
$$

**式 (4) の意味**：標準区間で得たガウス点・重みをそのまま再利用できる形に拡張した公式です。外側の \(J\) がスケール、内部が変換後の評価点を表します。

---

# 3章 │ Python 実装テンプレート（多点数対応・任意区間）

```python
# === Gauss-Legendre データ: n 点数 → (ガウス点リスト, 重みリスト) ===
gauss_data = {
    2: ([-0.577350269189626, 0.577350269189626], [1.0, 1.0]),
    3: ([-0.774596669241483, 0.0, 0.774596669241483],
        [0.555555555555556, 0.888888888888889, 0.555555555555556]),
    4: ([-0.861136311594053, -0.339981043584856,
          0.339981043584856,  0.861136311594053],
        [0.347854845137454, 0.652145154862546,
         0.652145154862546, 0.347854845137454]),
    5: ([-0.906179845938664, -0.538469310105683, 0.0,
          0.538469310105683,  0.906179845938664],
        [0.236926885056189, 0.478628670499366, 0.568888888888889,
         0.478628670499366, 0.236926885056189]),
}

def gauss_interval(f, a, b, n=2):
    """[a,b] 区間の n 点ガウス求積 (n=2〜5) — ★★ 空欄を埋めて完成させよう ★★"""
    # 1) ガウス点と重みを取得
    xg, wg = gauss_data[n]

    # 2) ヤコビアン J = (b-a)/2 を計算  ↓↓↓
    J = ...  # TODO: ここを計算式に置き換え

    # 3) 区間中心 c = (a+b)/2 を計算  ↓↓↓
    c = ...  # TODO: ここを計算式に置き換え

    # 4) 積分値を格納する変数を初期化
    s = 0.0

    # 5) ガウス点ごとにループして重み付き評価値を加算
    for xi, wi in zip(xg, wg):
        x = ...  # TODO: 変換後の評価点 x = J*xi + c
        s += ...  # TODO: 重みをかけて加算 wi * f(x)

    # 6) 最後にヤコビアン J を掛けて返す
    return ...  # TODO: J * s を返す
```

> **埋め方ガイド**
>
> 1. `J` は `0.5 * (b - a)`
> 2. `c` は `0.5 * (a + b)`
> 3. 変換後の評価点は `x = J * xi + c`
> 4. ループ内で `s += wi * f(x)`
> 5. 関数の戻り値は `J * s`\
>    これら 5 カ所を **TODO** 行に記述すれば完成します。

> **使い方**：`n` に 2〜5 を指定して任意点数を選択可。

---

### 3.1 サンプル計算例

被積分関数:

$$
f(x) = 2x^2 + 3x + 1
$$

解析積分:

$$
\int_{0}^{2} (2x^2 + 3x + 1) dx = \left[\frac{2}{3}x^3 + \frac{3}{2}x^2 + x\right]_{0}^{2} = \frac{40}{3} \approx 13.333333333
$$

```python
f = lambda x: 2*x**2 + 3*x + 1
approx = gauss_interval(f, 0, 2, n=2)
print(approx)  # -> 13.333333333333334
```

解析値 \(=40/3\) と一致し、誤差ゼロを確認。

---

## 3.2 演習問題（解答付き）

| # | 被積分関数             | 区間        | 指示                                                                      | 正しい積分値                              |
| - | ----------------- | --------- | ----------------------------------------------------------------------- | ----------------------------------- |
| 1 | \(2x^2 + 3x + 1\) | \([1,3]\) | **2点** ガウス求積で実装                                                         | 31.333333333 |
| 2 | \(\sin(3x)\)      | \([0,1]\) | **テーラー展開 3 次まで**: \(\sin(3x)\approx3x-\frac{(3x)^3}{6}\) を用い **2点** で計算 | 0.375                               |
| 3 | \(x^4 - x^2 + 1\) | \([0,2]\) | **3点** ガウス求積を用いる                                                        | 5.733333333                         |

> **ヒント**：問3は \(n=3\) を `gauss_interval` に渡して解くこと。

---

# 4章 │ 2変数ガウス求積法の導出

数値積分を 2 変数関数に拡張するため、まず物理空間と参照空間の座標系を定義し、一次写像とヤコビアン行列を導入します。最後に、一般的な 2 重積分からガウス求積の形に至るまでをステップ・バイ・ステップで示します。

---

## 4.1 座標の定義とヤコビアン行列

- **物理空間の座標**  
![image](https://github.com/user-attachments/assets/d1cea7d3-2b0d-4109-8ef1-5c9d0aeaf4eb)


- **参照空間（パラメータ空間）の座標**  
![image](https://github.com/user-attachments/assets/eeee38fc-45e2-4e1b-b0d8-1f161ea55b3a)


参照空間から物理空間へのアフィン一次写像を

![image](https://github.com/user-attachments/assets/b2bd1c28-39f6-4d9a-a128-94384c60ec70)


として定義します。ここで

![image](https://github.com/user-attachments/assets/cb9dd250-ed06-4933-a4b4-fc418a28e280)


**解説**：  
- 行列 **J** の対角要素が 𝜉・𝜂 方向のスケール変換を担い、  
- ベクトル **c** が領域の中心位置を表します。

---

## 4.2 2重積分の一般形

物理空間の 2 重積分は、

![image](https://github.com/user-attachments/assets/ae18f707-290a-45d2-8371-fc2ce10b454b)


**解説**：  
\( dy dx\) は物理空間の面積要素です。

---

## 4.3 変数変換とヤコビアンの導入

参照空間の面積要素を dξ dη とすると、

![image](https://github.com/user-attachments/assets/76c38997-08dd-48a3-8b79-530819634c1d)


**解説**：  
ヤコビアン det (**J**) が面積スケールを補正し、参照空間の要素を物理空間に変換します。

---

## 4.4 参照空間上の積分式

変換後の式は、

![image](https://github.com/user-attachments/assets/a46a468b-0033-491e-bd67-7cb179ee8398)


**解説**：  
- 関数 *f* は写像 **F**(ξ, η) で評価され、
- ヤコビアンで面積要素を補正します。

---

## 4.5 2変数ガウス求積公式

参照空間上のガウス点 \(\{(\ξ_i,w_i)\}\)、\(\{(\η_j,w_j)\}\) を用いて、

![image](https://github.com/user-attachments/assets/d626cda3-50aa-4455-8df1-cb3b6dc2c3fd)

---
title: "2変数ガウス求積法の実装と演習"
blocks:
  - type: markdown
    text: |
      # 2変数ガウス求積法の実装例
      以下のページでは、Python と `numpy` を用いて任意の長方形領域上の 2 変数積分をガウス–ルジャンドル求積で計算する関数 `two_dim_gauss` を実装します。

  - type: code
    language: python
    text: |
      import numpy as np

      def gauss_legendre(n):
          """
          n 次の 1次元ガウス–ルジャンドル求積のノードと重みを返す。
          """
          xi, wi = np.polynomial.legendre.leggauss(n)
          return xi, wi

      def two_dim_gauss(f, a, b, c, d, n):
          """
          2変数関数 f(x,y) を [a,b]×[c,d] 上で n×n ガウス求積で近似する。

          Parameters
          ----------
          f : callable
              積分する関数 f(x,y)
          a, b : float
              x の積分区間 [a,b]
          c, d : float
              y の積分区間 [c,d]
          n : int
              各軸の求積点数

          Returns
          -------
          float
              積分値の近似
          """
          xi, wi = gauss_legendre(n)
          eta, wj = xi, wi

          # アフィン変換によるヤコビアンの行列式
          J_det = (b - a) * (d - c) / 4.0

          I = 0.0
          for i in range(n):
              x = (b + a)/2 + (b - a)/2 * xi[i]
              for j in range(n):
                  y = (d + c)/2 + (d - c)/2 * eta[j]
                  I += wi[i] * wj[j] * f(x, y)

          return I * J_det

      # --- 使用例 ---
      if __name__ == "__main__":
          # f(x,y) = x^2 + y^2 を [-1,1]×[-1,1] で積分
          f = lambda x, y: x**2 + y**2
          val = two_dim_gauss(f, -1, 1, -1, 1, n=3)
          print("∫_{-1}^{1}∫_{-1}^{1} (x^2+y^2) dx dy ≈", val)

  - type: markdown
    text: |
      ## 演習問題
      以下の 3 問を解いて、実装を確認しましょう。

      ### 問題 1
      
      \[\iint_{[-1,1]^2} (x^2 + y^2)\,dx\,dy\] を n=2, n=3 のガウス求積で計算し、理論値と比較せよ。

      ### 問題 2
      
      \[\iint_{[0,1]\times[0,2]} e^{x+y}\,dx\,dy\] を n=3 のガウス求積で近似せよ。

      ### 問題 3
      
      \[\iint_{[1,2]\times[0,1]} x\,y\,dx\,dy\] を n=2 のガウス求積で近似せよ。

  - type: markdown
    text: |
      ## 解答例

      ### 問題 1 の解答
      - 理論値：
        \[
          \int_{-1}^1 x^2 dx = \tfrac{2}{3},\quad
          \int_{-1}^1 y^2 dy = \tfrac{2}{3},
        \]
        よって
        \[
          \iint (x^2+y^2)\,dA
          = 2\times\tfrac{2}{3} + 2\times\tfrac{2}{3}
          = \tfrac{8}{3} \approx 2.6667.
        \]
      - ガウス求積：
        ```python
        two_dim_gauss(lambda x,y: x**2+y**2, -1,1,-1,1,2)
        two_dim_gauss(lambda x,y: x**2+y**2, -1,1,-1,1,3)
        ```
        いずれも ≈ 2.6667

      ### 問題 2 の解答
      - 理論値：
        \[
          (e^2-1)(e-1) \approx 10.966
        \]
      - ガウス求積 (n=3)：
        ```python
        two_dim_gauss(lambda x,y: np.exp(x+y), 0,1,0,2,3)
        ```
        ≈ 10.966

      ### 問題 3 の解答
      - 理論値：
        \[
          \int_1^2 x dx = \tfrac{3}{2},\quad
          \int_0^1 y dy = \tfrac{1}{2},
        \]
        よって 0.75
      - ガウス求積 (n=2)：
        ```python
        two_dim_gauss(lambda x,y: x*y, 1,2,0,1,2)
        ```
        ≈ 0.75



